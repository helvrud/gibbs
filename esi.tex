\documentclass{elsarticle}
\input{definitions.tex}
\usepackage[margin=2.5cm]{geometry}% by courtesy of Mico
\begin{document}


\title{Supporting information to the article\\
\mytitle}

%\title{The \PE{} hydrogels as draw agents for desalination of solutions with multivalent ions}

%\tnotetext[t1]{This document is a collaborative effort.}
%\tnotetext[t2]{The second title footnote which is a longer longer than the first one and with an intention to fill in up more than one line while formatting.}

    \author[cuni,imc]{Oleg V. Rud}
    \ead{oleg.rud@natur.cuni.cz}
    \ead[url]{http://www.physchem.cz/}
    \author[cuni]{Alexander~D.~Kazakov}
    \author[cuni]{Lucie~Nova}
    %\author[cuni]{Peter~Kosovan}
    \author[cuni]{Filip~Uhlik}

\maketitle






\section{Theory behind the simulation\label{sec: theory}}

\reffig{fig:diamond} presents a diamond-like polymer network inserted in a simple cubic simulation box of volume $V_{\mathrm{box}}$ with periodic boundaries.
The network consists of $16$ linear \PE{} chains, each chain comprising $30$ monomer units.
Each unit is able to change its ionization state from charged to neutral and vice versa according to the ionization equilibrium.
The mobile ions ($\na$, $\cl$ and $\ca$) are present in certain amount such that they fulfill the electroneutrality condition.

We model the network in equilibrium with the bulk of aqueous solution.
In order to keep the equilibrium conditions we consider three processes to occur:

\begin{enumerate}
	\item the thermal movement of all segments in simulation box (Langevin dynamics);
	\item the ionization reaction equilibrium of \PE{} segments:
   	\begin{equation}
        \mathrm{HA}\leftrightarrows\mathrm{A}^{-}+\h\label{eq: acid reaction}
    \end{equation}
    \item the exchange of ion pairs between the gel and the bath (in order to keep electroneutrality of simulation box):
        \begin{eqnarray}
            \varnothing&\leftrightarrows&\na+\cl\label{eq: nacl reaction}\\
            \varnothing&\leftrightarrows&\ca+2\cl\label{eq: cacl reaction}\\
            %\varnothing&\leftrightarrows&2\na+\so\label{eq: naso reaction}
        \end{eqnarray}
%\todoi{We shall get rid of $\so$ ions and mention it in the inroduction. The reason is that their concentration is small, and they do not enter the hydrogel }
\end{enumerate}

All three processes occur simultaneously in real systems, however, we simulate them alternating each other in stop-run mode in a random order.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\columnwidth]{{figures/vmdscene}.pdf}
    \caption{
       	Diamond-like network in the simulation box. 
	Color code represents the individual ion types
	(red: $\na$, blue: $\cl$, yellow: $\ca$) and
        the hydrogel (gray: neutral segment ($\AH$), cyan: charged segment ($\A$)).
    }
    \label{fig:diamond}
    %in order to make snapshot use file snapshot.py
    % in order to edit the existing snapshot use file data/gel_MPC30_box_l53.0_pK7.00_pH7.00_pCl2.00_pCa2.94_lB0.0.vmd
\end{figure}

\subsection{Langevin dynamics\label{MD}}

We use three types of interactions, \ie bonded interactions, short-range non-bonded interactions and electrostatic interactions.

We use Finite extension nonlinear elastic (FENE) potential~\refeq{eq:fene} to account for the bonding interactions.
%The potential accounts for nonlinear elastic extensions and as a consequence, the simulation is not constrained too much.
\begin{equation}\label{eq:fene}
    V_\mathrm{FENE}(r) = -\frac{1}{2} K \Delta r_\mathrm{max}^2\ln \left[ 1 - \left(\frac{r-r_0}{\Delta r_\mathrm{max}} \right)^2 \right ],
\end{equation}
where $K$ is the magnitude of symmetric interaction between two segments,
$\Delta r_{\mathrm{max}}$ is the maximal stretching length of the bond and $r_0$ is the equilibrium bond length.
In our simulations we set $K = 10 \kT/\sigma^{2}$, $\Delta r_{\mathrm{max}} = 2 \sigma$ and $r_0 = 1.0\sigma$~\cite{Jin2007}.

We model the non-bonded interactions using truncated Lennard-Jones interaction potential.
This potential imposes strong repulsion between all particles at short distances:
\begin{equation}
    \begin{split}\label{eq:LJ}
        V_\mathrm{LJ}(r) =
        \begin{cases}
            4 \varepsilon \left( \left(\cfrac{\sigma}{r}\right)^{12}
            - \left(\cfrac{\sigma}{r}\right)^6\right)
            & \mathrm{if~} r < r_\mathrm{cut}\\
            0
            & \mathrm{elsewhere}
        \end{cases},
    \end{split}
\end{equation}
where $r$ is the interparticle distance,
$\sigma = 0.35 \mathrm{nm}$ is the characteristic size of the particles,
$\varepsilon$ is the depth of the potential well in $\kT$ units and $r_\mathrm{cut}$ is the cut-off distance beyond which the potential is set zero.

We model the long range electrostatic interactions by the Coulomb potential:
\begin{equation}
    V_{\mathrm{EL}}=\lb\kT \cfrac{q_{1}q_{2}}{r},
\end{equation}
where $\lb$ is Bjerrum length. We set $\lb = 2\sigma = 0.7 \mathrm{nm}$ which corresponds to water at $T=300 \mathrm{K}$.


We use Langevin thermostat, \ie
we add two additional terms to force in equation of motion
\begin{equation}
f_i =  -\gamma v_i(t)+\sqrt{2\gamma \kT }\eta_i(t),
\end{equation}
where the first term correspond to constant friction with $\gamma$ being a friction coefficient, and the second one corresponds to random thermal force with $\eta_i$ being a normally distributed random number (see for details \cite{Grest1986}).

%where $\gamma$ is the friction coefficient and .
%\todo{there is friction and there is random force ballanced by fluctiation dissipation theorem so that it is stationary}
%which causes the decrease of the particles' velocities.
%This is implemented by addition of two corresponding terms to the particles' equations of motion, namely
%\todo{usually -gamma v to keep gamma>0}
%where the first term correspond to 



%\paragraph{Units} % apart from cref reference all references are in the text. Do we need cref?
%By setting up the interaction potentials we defined the system of units.
%We have chosen the unit of length being based on the Bjerrum length in water at room temperature, $l_B \simeq 7$nm, and $\sigma=0.5l_B = 0.35$.
% % %Then the unit of concentration is $\cref=(\sigma^{3}\NA1000)^{-1}$mol/l. % % % do we need to say that?
%We set the energy unit to be $\varepsilon = \kT$.


\subsection{Sampling in the Gibbs ensemble\label{sec: sampling the gibbs ensemble}}
All thermal moves are frozen during the sampling of the ion pairs exchange.
The system represents the ensemble with constant number of particles distributed between two vessels (I) and (II).

In the following paragraph we derive the criteria for sampling of the ion exchange equilibrium.
\paragraph{Gibbs canonical ensemble}
Let us first consider the total free energy of both vesselsassuming that we have only particles of a single type:
\begin{equation}
    F=\left(E_{I}-TS_{I}\right) + \left(E_{II}-TS_{II}\right) \label{eq:F-gibbs}
\end{equation}
where $E$ is internal energy, $T$~--- temperature, $S$~--- entropy.

%Our model system represents a finite volume $V$ which exchanges particles with the bath of infinite volume.
%The infinity of the volume means, that the particle exchange between the system and the bath does not influence on the chemical potentials in the bath.
%Such ensemble is called grand canonical ensemble; the free energy in this ensemble, the Landau potential, is
The entropy $S$ is given by the Boltzmann formula~\cite{Nagle2004}:
\begin{equation}
    S=\kB\ln\frac{V^{N}}{N!}\label{eq:entropy}
\end{equation}
%\todo{for partiles without interactions}
where $N$ is a number of particles in corresponding vessel.
This formula accounts for two contributions:
\begin{enumerate}
    \item the combinatorial entropy $S_{c}=-\kB\ln N!$ which reflects the freedom of choice among $N$ particles
    \item the mixing entropy $S_{m}=\kB N\ln V$ which reflects the freedom to place the chosen particle randomly within the simulation box. 
\end{enumerate}
$V$ is the unitless volume, \ie the volume measured in units of $\sigma^3$. 
Thus \refeq{eq:F-gibbs} turns to 
%\todo{this is not reason, moreover A.10 is already wrong as for units}
\begin{equation}
    F=\EI-\kT\ln\frac{\VI^{\NI}}{\NI!}\ + \ \EII-\kT\ln\frac{\VII ^{\NII}}{{\NII} !}
\label{eq: F_gibbs}
\end{equation}
When a single particle transferred from the vessel (I) to the  vessel (II) the free energy in vessel (I) changes 
\begin{equation}
\Delta \FI = \Delta \EI+\kT\ln\frac{\VI^{\NI}}{\NI !} - \kT\ln\frac{\VI^{\NI-1}}{(\NI-1)!}=\Delta \EI + \kT\ln\frac{\VI}{\NI}
\end{equation}
whwereas the free energy change in (II) vessel is
\begin{equation}
\Delta \FII = \Delta \EII+\kT\ln\frac{\VII^{\NII}}{\NII !} - \kT\ln\frac{\VII^{\NII+1}}{(\NII+1)!}=\Delta \EII + \kT\ln\frac{\NII+1}{\VII}
\end{equation}
Thus the total change of free energy will be 
\begin{equation}
\Delta F = \Delta \EI+\Delta \EII+\kT\ln\frac{\VI}{\VII}\frac{\NII+1}{\NI}
\end{equation}
The change of free energy associated with a transfer of a single particle from vessel (I) to vessel (II)  is
\begin{equation}
    \Delta\Omega=\kT\ln\left(V^{\xi}\frac{N!}{\left(N+\xi\right)!}\right)+\Delta \EI+\Delta \EII
\label{eq: DeltaG GC}
\end{equation}
where $\xi=+1$ stands for insertion of a particle and $\xi=-1$ for deletion.

In order to simulate an ensemble which exchanges particles with the bath (bulk reservoir) we need to perform the following Monte Carlo procedure \cite{Frenlkel2002_book}
\begin{enumerate}
	\item we propose the new configuration of the system by insertion (or deletion) of a particle so that the total number of particles changes from $N$ to $N+\xi$, $\xi=\pm1$
	\item we accept the new configuration if
	\begin{equation}
        \mathcal{R}^{\xi}<e^{\Delta\Omega/\kT}=V^{\xi}\frac{N!}{(N+\xi)!}e^{\left(\Delta E+\xi\mu\right)/\kT}\label{eq: GC acceptance}
	\end{equation}
\end{enumerate}
where $\mathcal{R}$ is uniformly distributed random number in range between $0$ and $1$.

\paragraph{Sampling the ionization equilibrium}
We model the ionization equilibrium by means of sampling the reaction ensemble~\cite{Smith1994, Turner2008a}.
In the reaction ensemble we perform chemical reactions as simultaneous insertion, deletion or identity change of particles according to the reaction equation.
For example we assume the ionization of an acidic unit which proceeds according to the reaction equation
\begin{equation}
    \mathrm{AH}\stackrel{K}{\leftrightarrows}\A+\h\label{eq: acid reaction}
\end{equation}
We perform the forward direction of this reaction
by inserting a $\h$ particle and replacing $\AH$ by $\A$.
We perform the reverse direction of this reaction
by deleting a $\h$ particle and replacing $\A$ by $\AH$.

In order to account for the particles creation and deletion
we need to introduce standard states for individual reacting species.
The creation of a particle then means that the particle is removed from the standard state
and inserted into the studied system, and vice versa for deletion.
Each species in its standard state has the \emph{standard} chemical potential, $\mu^\ominus_i$.
The choice of standard state for each component is arbitrary
and we usually define it as pure component at standard pressure $10^5$ Pa
and concentration $1 \molperl$~\cite{IUPAC}.

Thus we rewrite the formula for free energy \refeq{eq:Omega-GC}
accounting for particles creation and deletion as
\begin{equation}
    \Omega=E-TS+\sum_i\left(\mu_i-\mu^\ominus_i\right) N_i\label{eq:Omega-RE}
\end{equation}
where the last term in \refeq{eq:Omega-RE} stands for the exchange of particles between the studied system and the standard states.

Let's have the reaction extent $\xi = (N_i - N_{i,0})/\nu_i$
where $N_i$, resp. $N_{i,0}$ is the actual, resp. initial number of the $i$-th particle species,
$\nu_i$ is its stoichiometric coefficient.
and $i$ runs over individual species involved
in the chemical reaction \refeq{eq: acid reaction} $i \in (\h,\ \A,\ \AH)$. 
The stoichiometric coefficients are positive for reaction products
and negative for reactants: $\nu_\h=1$, $\nu_\A=1$, $\nu_\AH=-1$.
Therefore we take $\xi = +1$ for the forward reaction direction
and $\xi = -1$ for the reverse reaction direction.
Then we can write the change of the free energy of the studied system during one reaction step as
\begin{equation}
\Delta\Omega_{\mathrm{re}}=\kT\ln\left(\prod_i V^{\nu_i\xi}\frac{N_i!}{\left(N_i+\nu_i\xi\right)!}\right)+
\xi\left(\sum_i\nu_i\mu_i-\sum_i\nu_i\mu_i^\ominus\right)+\Delta E
\label{eq: DeltaG RE one}
\end{equation}
%\begin{multline}
%    \Delta\Omega_{\mathrm{re}}=\kT\ln\left(\prod_i V^{\nu_i\xi}\frac{N_i!}{\left(N_i+\nu_i\xi\right)!}\right)+\\
%    \xi\left(\sum_i\nu_i\mu_i-\sum_i\nu_i\mu_i^\ominus\right)+\Delta E
%\label{eq: DeltaG RE one}
%\end{multline}

We write $\sum_i\nu_i \mu_i = 0$
for the chemical reaction in equilibrium.

The term $\sum_i\nu_i\mu_i^\ominus$ is the standard Gibbs free energy change
of the reaction \refeq{eq: acid reaction}.
which defines the equilibrium reaction constant \cite{Atkins} as
\begin{equation}
    K = e^{-\sum_i\nu_i \mu_i^\ominus / \kT}
\end{equation}

Finally, the \refeq{eq: DeltaG RE one} translates to
\begin{equation}
    \Delta\Omega_{\mathrm{re}}=\kT\ln\left(K^\xi\prod_i V^{\nu_i\xi}\frac{N_i!}{\left(N_i+\nu_i\xi\right)!}\right)+\Delta E
\label{eq: DeltaG RE two}
\end{equation}

\subsection{Ion pairs insertions\label{sec: ion insertions}}
We treat the exchange of mobile ions with the reservoir as simultaneous insertion or deletion
of ion pairs or sets in the simulation box.
We insert/delete either $\na$ and $\cl$ ion pair or the two $\cl$ ions together with one $\ca$ ion.
Thus we model the insertion as:
\begin{eqnarray}
    \na +  \cl &\leftrightarrows& \emptyset\label{eq:nacl} \\
    \ca + 2\cl &\leftrightarrows& \emptyset \label{eq:cacl}
\end{eqnarray}
with the corresponding equilibrium reaction constants, reflecting the free energy change during the insertion
\begin{eqnarray*}
    K_\mathrm{NaCl}     = \exp\left(\left(\mu_\na+ \mu_\cl \right) /\kT\right), \\
    K_{\mathrm{CaCl}_2} = \exp\left(\left(\mu_\ca+2\mu_\cl \right /\kT\right))
\end{eqnarray*}
%$K_\mathrm{NaCl}= \exp\left(\mu_\na+\mu_\cl \right)$, $K_{\mathrm{CaCl}_2} = \exp\left(\mu_\ca+2\mu_\cl \right)$

\paragraph{Moderate pH conditions\label{sec: moderate pH conditions}}
In our study we consider the chemical equilibrium between the gel system and reservoir at neutral pH,
which means that the concentration of $\h$ ions in the reservoir is $c_\h=\unit[10^{-7}]{mol/l}$.
At the same time we include rather high salinities \ie $\cs \gtrsim \unit[0.006]{mol/l}$,
so that the concentrations of $\h$ ions and salt ions, $\na$ and $\ca$, differ by at least three orders of magnitude.
%If one had have wanted to simulate a system with at least 10 $\h$ particles, he would have to include $10^5$ of $\na$ particles there,  and not to mention the amount of polymer needed.
Under such conditions the sampling of the reaction \refeq{eq: acid reaction}
is very difficult because of the lack of $\h$ ions.
Following the scheme proposed in \cite{Landsgesel2020} and \cite{Rud2020},
we sample this reaction assuming that
it is accompanied by simultaneous exchange of counterions $\na$ and $\ca$ by $\h$ ion
with corresponding Gibbs free energy changes\cite{Smith1991}:
\begin{eqnarray}
     \h&\leftrightarrows&\na, \quad \Delta\Omega' = \mu_\h-\mu_\na   \label{eq:hna} \\
    2\h&\leftrightarrows&\ca, \quad \Delta\Omega'' = 2\mu_\h-\mu_\ca \label{eq:cacl}
\end{eqnarray}

Summing up the reactions \refeq{eq: acid reaction} with \refeq{eq:hna} and with \refeq{eq:cacl}
we obtain two reactions
\begin{eqnarray}
    \mathrm{HA}&\stackrel{K'}{\leftrightarrows}&\mathrm{A}^{-}+\na\label{eq: acid reaction na}\\
    2\mathrm{HA}&\stackrel{K''}{\leftrightarrows}&2\mathrm{A}^{-}+\ca\label{eq: acid reaction ca}
\end{eqnarray}
where $K'$ and $K''$ are the modified reaction constants which account for the free energy costs caused by the ions exchange, $\Delta\Omega''$ and $\Delta\Omega'$
\begin{eqnarray}
    K' &=& K \exp\left((\mu_\h-\mu_\na)/\kT\right) \label{eq:Gamma'}\\
    K'' &=& K \exp\left((2\mu_\h-\mu_\ca)/\kT\right)\label{eq:Gamma''}
\end{eqnarray}
We sample these two reactions instead of \refeq{eq: acid reaction}.
Then the final equations for the reactions acceptance criteria are obtained by replacing $K$
in \refeq{eq: DeltaG RE two} by $K'$ and $K''$.

Note that we used the approximation of low concentration of $\h$,
which is valid in conditions close to neutral $\pH$,
and generalize the model considering only three types of ions, namely $\na$, $\cl$ and $\ca$.
The value of $\pH$ enters the model only through Equations \ref{eq:Gamma'} and \ref{eq:Gamma''}.




\bibliographystyle{plain}
\bibliography{gibbs}


\newpage
\pagebreak

\end{document}
